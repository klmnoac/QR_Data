<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f9;
      color: #333;
      padding: 1rem;
    }
    .container {
      max-width: 400px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #444;
    }
    #reader {
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    select {
      width: 100%;
      padding: 10px;
      margin: 1rem 0;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .result, .history {
      background: #fff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-top: 1rem;
    }
    .result span {
      font-weight: bold;
      color: #2a9d8f;
    }
    ul {
      padding-left: 20px;
    }
    li {
      margin-bottom: 5px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>QR Scanner</h1>

  <select id="camera-select"></select>
  <div id="reader"></div>

  <div class="result">
    <p>Scanned QR: <span id="qr-result">None</span></p>
  </div>

  <div class="history">
    <h3>Scan History</h3>
    <ul id="scan-history"></ul>
  </div>
</div>

<script>
  const resultContainer = document.getElementById('qr-result');
  const historyList = document.getElementById('scan-history');
  const cameraSelect = document.getElementById('camera-select');

  let html5QrCode;
  let currentCameraId;

  function addToHistory(data) {
    const existing = JSON.parse(localStorage.getItem('qrHistory')) || [];
    existing.push(data);
    localStorage.setItem('qrHistory', JSON.stringify(existing));
    renderHistory();
  }

  function renderHistory() {
    const history = JSON.parse(localStorage.getItem('qrHistory')) || [];
    historyList.innerHTML = '';
    history.slice(-10).reverse().forEach((item, index) => {
      const li = document.createElement('li');
      li.textContent = `${item}`;
      historyList.appendChild(li);
    });
  }

  function onScanSuccess(decodedText) {
    resultContainer.textContent = decodedText;
    addToHistory(decodedText);
  }

  function startScanner(cameraId) {
    if (html5QrCode) {
      html5QrCode.stop().then(() => {
        html5QrCode.clear();
        start(cameraId);
      });
    } else {
      start(cameraId);
    }
  }

  function start(cameraId) {
    html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      cameraId,
      { fps: 10, qrbox: 250 },
      onScanSuccess
    );
  }

  Html5Qrcode.getCameras().then(cameras => {
    if (cameras.length) {
      cameraSelect.innerHTML = '';
      cameras.forEach(cam => {
        const option = document.createElement('option');
        option.value = cam.id;
        option.text = cam.label || `Camera ${cameraSelect.length + 1}`;
        cameraSelect.appendChild(option);
      });

      currentCameraId = cameras[0].id;
      startScanner(currentCameraId);

      cameraSelect.addEventListener('change', (e) => {
        currentCameraId = e.target.value;
        startScanner(currentCameraId);
      });
    } else {
      alert("No cameras found");
    }
  }).catch(err => console.error(err));

  renderHistory(); // Load on start
</script>

</body>
</html>
